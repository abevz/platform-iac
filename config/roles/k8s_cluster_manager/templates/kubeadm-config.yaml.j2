---
apiVersion: kubeadm.k8s.io/v1beta3 # Возвращаемся к рабочему API
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: {{ ansible_default_ipv4.address }}
  bindPort: 6443
nodeRegistration:
  kubeletExtraArgs:
    node-ip: {{ ansible_default_ipv4.address }}
---
apiVersion: kubeadm.k8s.io/v1beta3 # Возвращаемся к рабочему API
kind: ClusterConfiguration
# ОКОНЧАТЕЛЬНОЕ ИСПРАВЛЕНИЕ: Форматирование версии
# Если версия равна "1.33", она станет "v1.33.0"
kubernetesVersion: "v{{ kubernetes_version | replace('v', '') }}{{ '.0' if kubernetes_version | length < 6 else '' }}"
controlPlaneEndpoint: "{{ ansible_fqdn }}:6443"
apiServer:
  certSANs:
  - {{ ansible_default_ipv4.address }}
  - {{ ansible_hostname }}
  - {{ ansible_fqdn }}
  - localhost
  - 127.0.0.1
  - kubernetes
  - kubernetes.default
  - kubernetes.default.svc
  - kubernetes.default.svc.cluster.local
networking:
  dnsDomain: cluster.local
  podSubnet: {{ pod_cidr }}
  serviceSubnet: 10.96.0.0/12
