#!/bin/bash
# Managed by Ansible (platform-iac)

ACTION=$1
# Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ jq Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° Ð²Ñ‹Ð²Ð¾Ð´Ð° niri
CURRENT=$(niri msg -j keyboard-layouts | jq '.[] | select(.is_active) | .idx')

case $ACTION in
  "toggle")
    # Ð›Ð¾Ð³Ð¸ÐºÐ°: Ð•ÑÐ»Ð¸ 0(US) -> 1(RU). Ð˜Ð½Ð°Ñ‡Ðµ (RU/UA/PL) -> 0(US)
    if [ "$CURRENT" -eq "0" ]; then
      niri msg action set-keyboard-layout 1
      notify-send -t 1000 -u low "Layout" "ðŸ‡·ðŸ‡º RU (Russian)"
    else
      niri msg action set-keyboard-layout 0
      notify-send -t 1000 -u low "Layout" "ðŸ‡ºðŸ‡¸ EN (English)"
    fi
    ;;
  "ua")
    niri msg action set-keyboard-layout 2
    notify-send -t 1000 -u low "Layout" "ðŸ‡ºðŸ‡¦ UA (Ukrainian)"
    ;;
  "pl")
    niri msg action set-keyboard-layout 3
    notify-send -t 1000 -u low "Layout" "ðŸ‡µðŸ‡± PL (Polish)"
    ;;
  *)
    echo "Usage: $0 {toggle|ua|pl}"
    exit 1
    ;;
esac
