---
- name: Restart containerd
  ansible.builtin.systemd:
    name: containerd
    state: restarted

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: Hold Kubernetes packages Debian
  ansible.builtin.dpkg_selections:
    name: "{{ item }}"
    selection: hold
  loop:
    - kubelet
    - kubeadm
    - kubectl
  when: ansible_os_family == "Debian"

- name: Hold Kubernetes packages RedHat
  ansible.builtin.command: "dnf versionlock add {{ item }}"
  loop:
    - kubelet
    - kubeadm
    - kubectl
  when: ansible_os_family == "RedHat"
